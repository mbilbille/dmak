/*
 *  Draw Me A Kanji - v0.2.0
 *  A funny drawer for your Japanese writings
 *  http://drawmeakanji.com
 *
 *  Made by Matthieu Bilbille
 *  Under MIT License
 */
!function(){"use strict";function a(a){var b,c,d,e,f=[];for(d=0;d<a.length;d++)for(e=0;e<a[d].paths.length;e++)c=Raphael.getTotalLength(a[d].paths[e]),b={"char":d,length:c,duration:c*h.options.step*1e3,path:a[d].paths[e],text:a[d].texts[e],object:{path:null,text:null}},f.push(b);return f}function b(a){var b,c,d=[];for(c=0;a>c;c++)b=new Raphael(h.options.element,h.options.width+"px",h.options.height+"px"),b.setViewBox(h.options.viewBox.x,h.options.viewBox.y,h.options.viewBox.w,h.options.viewBox.h),b.canvas.setAttribute("class","dmak-svg"),d.push(b);return d.reverse()}function c(a){var b;for(b=0;b<a.length;b++)a[b].path("M"+h.options.viewBox.w/2+",0 L"+h.options.viewBox.w/2+","+h.options.viewBox.h).attr(h.options.grid.attr),a[b].path("M0,"+h.options.viewBox.h/2+" L"+h.options.viewBox.w+","+h.options.viewBox.h/2).attr(h.options.grid.attr)}function d(a,b){b.object.path=a.path(b.path),b.object.path.attr(h.options.stroke.attr),h.options.stroke.animated?f(a,b):"random"===h.options.stroke.attr.stroke&&(b.object.path.node.style.stroke=Raphael.getColor())}function e(a,b){b.object.text=a.text(b.text.x,b.text.y,b.text.value),b.object.text.attr(h.options.stroke.order.attr)}function f(a,b){b.object.path.attr({stroke:h.options.stroke.attr.active}),b.object.path.node.style.transition=b.object.path.node.style.WebkitTransition="none",b.object.path.node.style.strokeDasharray=b.length+" "+b.length,b.object.path.node.style.strokeDashoffset=b.length,b.object.path.node.getBoundingClientRect(),b.object.path.node.style.transition=b.object.path.node.style.WebkitTransition="stroke-dashoffset "+b.duration+"ms ease",b.object.path.node.style.strokeDashoffset="0",setTimeout(function(){if(null!==b.object.path){h.options.stroke.order.visible&&e(a,b);var c=h.options.stroke.attr.stroke;"random"===h.options.stroke.attr.stroke&&(c=Raphael.getColor()),b.object.path.node.style.stroke=c,b.object.path.node.style.transition=b.object.path.node.style.WebkitTransition="stroke 400ms ease"}},b.duration)}function g(a,b){var c,d=a;if(2!==arguments.length)throw new Error("Missing arguments in extend function");for(c in b)"object"==typeof d[c]?d[c]=g(d[c],b[c]):d.hasOwnProperty(c)&&(d[c]=b[c]);return d}var h=function(a,b){if(this.text=a,this.options=g(h.options,b),this.strokes=[],this.papers=[],this.pointer=0,this.timeouts=[],!this.options.skipLoad){var c=new DmakLoader(this.options.uri);c.load(a,function(a){this.prepare(a),this.options.loaded(this.kanjis),this.options.autoplay&&this.render()}.bind(this))}};h.VERSION="0.2.0",h.options={uri:"",skipLoad:!1,autoplay:!0,height:109,width:109,viewBox:{x:0,y:0,w:109,h:109},step:.03,element:"draw",stroke:{animated:!0,order:{visible:!1,attr:{"font-size":"8",fill:"#999999"}},attr:{active:"#BF0000",stroke:"#2C2C2C","stroke-width":4,"stroke-linecap":"round","stroke-linejoin":"round"}},grid:{show:!0,attr:{stroke:"#CCCCCC","stroke-width":.5,"stroke-dasharray":"--"}},loaded:function(){},erased:function(){},drew:function(){}},h.fn=h.prototype={prepare:function(d){this.kanjis=a(d),this.papers=b(d.length),this.options.grid.show&&c(this.papers)},erase:function(a){if(this.timeouts.length)return!1;if(this.pointer<=0)return!1;"undefined"==typeof a&&(a=0);do this.pointer--,null!==this.kanjis[this.pointer].object.text&&this.kanjis[this.pointer].object.text.remove(),this.kanjis[this.pointer].object.path.remove(),this.kanjis[this.pointer].object={path:null,text:null},this.options.erased(this.pointer);while(this.pointer>a)},render:function(a){if(this.timeouts.length)return!1;if("undefined"==typeof a)a=this.kanjis.length;else if(a>this.kanjis.length)return!1;var b,c,e=function(a){d(a.papers[a.kanjis[a.pointer].char],a.kanjis[a.pointer]),a.pointer++,a.timeouts.shift(),a.options.drew(a.pointer)},f=0;for(b=this.pointer;a>b;b++)!h.options.stroke.animated||0>=f?e(this):(c=setTimeout(e,f,this),this.timeouts.push(c)),f+=this.kanjis[b].duration},pause:function(){for(var a=0;a<this.timeouts.length;a++)window.clearTimeout(this.timeouts[a]);this.timeouts=[]},eraseLastStrokes:function(a){this.erase(this.pointer-a)},renderNextStrokes:function(a){this.render(this.pointer+a)}},window.Dmak=h}(),function(){"use strict";function a(a,c,d,e){var f=new XMLHttpRequest,g=("00000"+d).slice(-5);return"00020"===g||"03000"===g?(e.done(c,{paths:[],texts:[]}),void 0):(f.open("GET",a+g+".svg",!0),f.onreadystatechange=function(){4===f.readyState&&(200===f.status?e.done(c,b(f.response)):e.error(f.statusText))},f.send(),void 0)}function b(a){var b,c={paths:[],texts:[]},d=(new DOMParser).parseFromString(a,"application/xml"),e=d.querySelectorAll("path"),f=d.querySelectorAll("text");for(b=0;b<e.length;b++)c.paths.push(e[b].getAttribute("d"));for(b=0;b<f.length;b++)c.texts.push({value:f[b].textContent,x:f[b].getAttribute("transform").split(" ")[4],y:f[b].getAttribute("transform").split(" ")[5].replace(")","")});return c}var c=function(a){this.uri=a};c.prototype.load=function(b,c){var d,e=[],f=b.length,g=0,h={done:function(a,b){e[a]=b,g++,g===f&&c(e)},error:function(a){console.log("Error",a)}};for(d=0;f>d;d++)a(this.uri,d,b.charCodeAt(d).toString(16),h)},window.DmakLoader=c}();